<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>原生定位</title>
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<style type="text/css">
			.mui-content {
				margin: 20px;
			}
			
			#geolocation {
				margin-top: 50px;
			}
			
			.error {
				color: red;
			}
			
			.not-plus {
				overflow-wrap: break-word;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">原生定位</h1>
		</header>
		<div class="mui-content" id="app">
			
			<!--获取位置信息-->
			<div class="posInfo mui-plus-visible">
				<p>wap2app环境下自动获取当前位置信息</p>
				<p>地址: <span class="posInfo-address">{{posInfo.address}}</span></p>
				<p>经度: <span class="posInfo-lon">{{posInfo.lon}}</span></p>
				<p>纬度: <span class="posInfo-lat">{{posInfo.lat}}</span></p>
				<p class="error">{{posInfo.err}}</p>
			</div>

			<div class="posInfo mui-plus-hidden">
				<p>浏览器环境下获取当前位置信息</p>
				<div class="not-plus"></div>
				<p>地址: <span class="not-plus-address">{{posInfo.address}}</span></p>
				<p>经度: <span class="not-plus-lon">{{posInfo.lon}}</span></p>
				<p>纬度: <span class="not-plus-lat">{{posInfo.lat}}</span></p>
				<p class="error">{{posInfo.err}}</p>
			</div>
			<button class="mui-btn mui-btn-block" id="geolocation">重新获取定位当前位置</button>
			
			<div style="margin-top:50px;">
				<p>
					注：<br/>开发者如果需要打包成原生安装包的话，必须在manifest.json中单独配置百度或高德的参数
				</p>
			</div>
		</div>
		<script src="../js/app.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/plusGeolocation.js?v=2" type="text/javascript" charset="utf-8"></script>
		<script src="../js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script>
			(function() {
				// 判断是否在5+环境下
				var isPlus = navigator.userAgent.indexOf("Html5Plus") > -1;
				if(isPlus) {
					document.body.classList.add('mui-plus');
					plusReady(function() {
						document.getElementById('geolocation').click();
					});
				} else {
					document.body.setAttribute('class', '');
					document.getElementById('geolocation').click();
				}
				
				
				function plusReady(callback) {
					var readyRE = /complete|loaded|interactive/;
					if(window.plus) {
						setTimeout(function() {
							callback();
						}, 0);
					} else {
						document.addEventListener("plusready", function() {
							callback();
						}, false);
					}
				}

				var vm = new Vue({
					el: '#app',
					data: function() {
						return {
							posInfo: {
								address: '',
								lon: '',
								lat: '',
								err: ''
							}
						}
					}
				})
				
				function resetData() {
					vm.posInfo = {
						address:'',
						lon:'',
						lat:'',
						err:''
					}
				}
				/**
				 * 点击按钮获取位置信息
				 */
				document.getElementById('geolocation').addEventListener('click', function(e) {
					resetData();
					if(isPlus) {
						navigator.geolocation.getCurrentPosition(function(p) {
							vm.posInfo = {
								address: p.addresses,
								lon: p.coords.longitude,
								lat: p.coords.latitude,
								err: ''
							}
						}, function(err) {
							vm.posInfo.err = err.code + ':' + err.message;
						})
					} else {
						navigator.geolocation.getCurrentPosition(function(p) {
							vm.posInfo = {
								address: p.addresses,
								lon: p.coords.longitude,
								lat: p.coords.latitude,
								err: ''
							}
						}, function(err) {
							vm.posInfo.err = '浏览器环境下：' + err.message;
						})
					}
				})

			})();
		</script>
	</body>

</html>